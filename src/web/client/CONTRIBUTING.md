THANKS FOR CONTRIBUTING
-----------------------

Issue reports and pull requests are always welcome!

## Code Style

- Use Tab for indentation
- Limit lines to 100 columns


### Return early from a function

- DONT

``` sourceCode
function foo() {
  if (x) {
    ...
  }
}
```

- DO

``` sourceCode
function foo() {
  if (!x) {
    return;
  }

  ...
}
```

Keep indentation level lower and it will be readable.

## tagについて
Riotのtagは、Jade+Stylus+LiveScriptで書きます(すべてインデントでブロックを表すタイプの言語(！))。
**それに加え、Misskey独自の拡張/改良を加えています:**
* タグファイル内のscriptおよびstyleのインデントは不要です(本来ならばtagの子にしなければならないために、**無意味に**一段ネストが深くなってしまう(tagの子でなくとも、同じファイルに記述されている以上、そのstyleとscriptはそのtagのものであるということが**明らか**))。
* タグファイル内のscriptおよびstyleにtypeやscopedの指定は不要です。styleは、デフォルトで*scoped*です(*scoped*以外のstyleをタグファイルに記述したい場合なんてあるか？？？？？？)。
* styleは暗黙的に:scopeがルートに存在しているとみなします(scope以外にスタイルを当てたい場合なんてあるか？？？？？？？？？？？？？？？？？？？？？？？？)。
* テンプレート変数を記述する際に、本来ならばJade特有の記法と競合してしまうために`hoge='{piyo}'`と書かなければいけませんが、`hoge={piyo}`と書けるようにしています(その代償としてJadeのstyle記法は使えなくなりました(まあそんなに使うことないと思うので))。
* `div(name='hoge')`は、`div@hoge`と書けます。Riot.jsの特性上、nameを指定することが多いので、このように短く書けるようにしました。また、script(LiveScript)上において、name指定した要素を@hogeのようにしてアクセスするので(LiveScriptでは、`this.`を`@`と書けます)、表現が一致して分かりやすくなります。
* スタイルには暗黙的に`$theme-color`と`$theme-color-foreground`変数が宣言されます。
* Jadeには暗黙的に`config`変数が設定されます。これには設定ファイルの内容が含まれます。

まとめると、以下のコード
```jade
todo
	h3 TODO

	ul
		li(each='{ item, i in items }')= '{ item }'

	form(onsubmit='{ handleSubmit }')
		input
		button
			| Add { items.length + 1 }

	script.
		@items = []

		@handle-submit = (e) ~>
			input = e.target.0
			@items.push input.value
			input.value = ''

	style(type='stylus', scoped).
		:scope
			$theme-color = #ec6b43

			background #fff

			> h3
				font-size 1.2em
				color $theme-color
```

は、以下のように書けるということです:

```jade
todo
	h3 TODO

	ul
		li(each={ item, i in items })= { item }

	form(onsubmit={ handleSubmit })
		input
		button
			| Add { items.length + 1 }

script.
	@items = []

	@handle-submit = (e) ~>
		input = e.target.0
		@items.push input.value
		input.value = ''

style.
	background #fff

	> h3
		font-size 1.2em
		color $theme-color
```

styleに至っては二段も**余計な**インデントを無くすことができました。

## 設計思想
タグは、他のタグのDOM構造がどのようになっているかは知る必要がなく、自分自身のDOM構造だけ知っていれば良いようにします。
たとえばタイムライン タグがあり、その中に投稿タグが配列されている場合を考えます。このとき、タイムライン タグが、ユーザーのキーボード入力を監視して「t」キーが押されたときに、タイムラインの最新の投稿タグにフォーカスを合わせたいとします。
ここで、タイムライン タグは投稿タグのDOMを知らないので、フォーカスを合わせるにはどうしたら良いのでしょうか。
良い解決策は、タグ間で、イベントのやり取りを行うことです。投稿タグは「キミにフォーカスを当てたい」というイベントが来るか監視し、イベントがきたときに自分自身のDOMにフォーカスを当てるコードを書けばいいのです。タイムライン タグは、「t」キーが押下されたときに、投稿タグに対して、先の「フォーカスを当ててくれ」イベントを発信するだけでいいのです。
これで、タイムライン タグは、投稿タグの内部のDOM的な実装を知ることなしに、フォーカスを合わせることができます。

気づいた方もいるかもしれませんが、**これはオブジェクト指向ではないでしょうか？**
タグの内部実装を知る必要がないのはカプセル化に値し、イベントの送受信はクラスのインスタンスに対するメソッド呼び出しのようなものです。
だから、Misskeyのクライアントサイド設計は、オブジェクト指向的であると言って良いと思います。

また、Riot.jsに yield が備わっているおかげで、継承のようなことも出来ます。たとえばドラッグして位置を移動できる、ウィンドウ タグを実装する場合を考えます。
ウィンドウ タグは、自分自身に**入れられた**要素を、ヘッダーとコンテンツとして解釈し、それをウィンドウで覆います。
もちろん、中に入れられる要素は、ウィンドウのことは考える必要がありません。
このウィンドウ タグを利用するときは、たとえば次のようなHTMLになるでしょう:
``` html
<window>
  <header>新規投稿</header>
  <body>
    <textarea>ここに投稿内容を入力してください！</textarea>
    <button>投稿</button>
  </body>
</window>
```
この例だと、中に入っている投稿フォームは、ウィンドウの「閉じる」ボタンが押されたときにウィンドウを閉じるコードを書く必要はありませんし(つまりウィンドウという存在を認識しない)、逆にウィンドウ タグ側も、自分自身のヘッダーがドラッグされたときに自信を動かすことや、閉じるボタンがクリックされたときに自信を閉じる以外のことは、なにも気にしなくて良いのです。中に入っている投稿フォームの投稿ボタンが押されたときに投稿をサーバーに送信したりも、もちろんウィンドウ タグは行いません。
それぞれ、自分の役目を果たすだけで良いのですっ。他のタグのことなんて感知しなくてOKなんです。

## 「後片付け」
Misskeyは基本的にSPAです。
つまりHTMLを初期化することなくページの切り替えを実現します。
そうなると設定していたintervalやイベントのlistenなどはタグのunmount時に解除する必要があります。
これを忘れてしまうと、ページが切り替わってもいつまでもイベントがキャプチャされ、不具合が発生したりパフォーマンスに影響が出たりします。

## キャッシュ
高速な読み込みと無駄な通信を減らすために、ユーザー情報をLocalStorageにキャッシュします。
登録は自動(後述)で行われ、取得は手動です。
ある程度(現時点では1日)古い(=*新鮮でない*)データは破棄されます。
*この機能はユーザーが無効にすることができます。*

### 登録機序
このMisskeyのキャッシュ機構は、**全ての**API通信を監視しています。このとき、レスポンスに「ユーザーと思われるデータ」があれば、それを「*新鮮な*」情報として判断し、キャッシュを更新します。

## API

Misskeyは以下の機能を提供します:

### ウィンドウ
``mk-window``を利用してウィンドウを表示できます。

### ダイアログ
対話可能ダイアログを表示するには、**dialog**ミックスインを利用してください。
ユーザーにメッセージを表示したり、「はい」「いいえ」などの選択肢の提示も行うことができます。
**このダイアログは常にモーダルで表示されます。**

### インプットダイアログ
ユーザーにテキストを入力してもらいたい場合は**input-dialog**ミックスインを利用してください。

## その他

### mk
**M**iss**k**eyの略です。
W3Cはカスタムのタグ名にハイフンを含めることを要求しているため、Misskeyのすべてのタグは「mk-」をプリフィクスします(ファイル名には不要)。

# Design

## Desktop
ややリッチよりのフラットデザイン

## Mobile
フラットデザイン
